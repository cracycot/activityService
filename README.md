# Сервис Аналитики

## Содержание

- [Введение](#введение)
- [Используемые-Технологии](#используемые-технологии)
- [Функциональные-Возможности](#функциональные-возможности)
- [Архитектура](#архитектура)
- [API-Эндпоинты](#api-эндпоинты)

---

## Введение

**Сервис Аналитики** — это высокопроизводительный и масштабируемый сервис, предназначенный для сбора и анализа пользовательской активности в рамках социальной сети. Основная задача сервиса — принимать сообщения о действиях пользователей из **Kafka**, начислять или снимать баллы (очки) для пользователей и предоставлять API для просмотра рейтинга по убыванию баллов.

Этот учебный проект демонстрирует интеграцию **Kafka** и **Redis** для обеспечения быстрой и эффективной обработки активности пользователей.

---

## Используемые Технологии

- **Java 21**
- **Spring Boot 3.1.4**
- **Kafka** (для приёма и обработки сообщений об активности)
- **Redis** (для хранения рейтинга пользователей)
- **JUnit 5** (для модульного тестирования)
- **Mockito** (для моков)
- **Maven** (в качестве системы сборки)

---

## Функциональные Возможности

- **Приём сообщений** из Kafka о действиях пользователей (например, `add:` или `remove:`).
- **Начисление / списание баллов** пользователям на основе поступивших событий.
- **Хранение рейтинга** пользователей в Redis (Sorted Set) для быстрого доступа.
- **Предоставление API** (REST) для получения топа пользователей по их баллам.
- **Модульное тестирование** для проверки корректности обработки данных и API.

---

## Архитектура

Сервис Аналитики следует **микросервисному** подходу и обеспечивает гибкость и масштабируемость. Основные компоненты:

1. **Слой Сообщений (Kafka Consumer)**
    - Подписан на топик `activity`.
    - Получает события о действиях пользователей (`add:`, `remove:`).
    - Парсит данные и вызывает методы в сервисе работы с Redis.

2. **Слой Сервисов (RedisService)**
    - Инкапсулирует логику по работе с Redis.
    - Осуществляет добавление, инкремент/декремент и удаление элементов в `Sorted Set`.
    - Предоставляет методы для получения топа пользователей.

3. **Слой Контроллеров (ActivityController)**
    - Предоставляет REST API для получения рейтинга (`GET /activities/get`).
    - Считывает параметр `size` (количество записей рейтинга) и запрашивает соответствующие данные у `RedisService`.
    - Возвращает результаты клиенту.

Ниже условная схема:

---

## API-Эндпоинты

### Получение Рейтинга

- **URL**: `/activities/get`
- **Метод**: `GET`
- **Параметры**:
    - `size` (*int*, необязательный, по умолчанию `10`) — сколько пользователей нужно вернуть из топа.
- **Ответы**:
    - **200 OK** — Возвращается список (JSON массив) идентификаторов пользователей, отсортированных по убыванию их баллов.
    - **500 INTERNAL SERVER ERROR** — При ошибке (например, проблемы с Redis).

Пример запроса: